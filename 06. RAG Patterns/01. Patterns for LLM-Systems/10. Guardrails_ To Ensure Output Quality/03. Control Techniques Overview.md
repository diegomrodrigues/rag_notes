## Guardrails em RAG: TÃ©cnicas de Controle para Qualidade da SaÃ­da

### IntroduÃ§Ã£o

A garantia da qualidade da saÃ­da em sistemas Retrieval-Augmented Generation (RAG) Ã© crucial para sua aplicabilidade em cenÃ¡rios sensÃ­veis. Sistemas RAG, ao combinar recuperaÃ§Ã£o de informaÃ§Ã£o e geraÃ§Ã£o de texto, estÃ£o suscetÃ­veis a produzir respostas imprecisas, tendenciosas ou atÃ© mesmo prejudiciais. Neste capÃ­tulo, exploraremos tÃ©cnicas de controle que visam mitigar esses riscos, assegurando que as respostas geradas sejam Ãºteis, inofensivas e honestas [^3]. Abordaremos o uso de *guided prompts* para influenciar a geraÃ§Ã£o de respostas e a validaÃ§Ã£o da saÃ­da atravÃ©s de requisitos estruturais, de tipo e de qualidade [^3].

### Conceitos Fundamentais

A qualidade da saÃ­da em sistemas RAG depende de diversos fatores, incluindo a qualidade dos documentos recuperados, a eficÃ¡cia do modelo de linguagem e as estratÃ©gias de controle implementadas. As tÃ©cnicas de controle, tambÃ©m conhecidas como *guardrails*, atuam como barreiras de proteÃ§Ã£o, guiando o modelo de linguagem na geraÃ§Ã£o de respostas desejÃ¡veis [^3].

**Guided Prompts:**

*Guided prompts* sÃ£o prompts cuidadosamente elaborados para influenciar o modelo de linguagem a gerar respostas que atendam a critÃ©rios especÃ­ficos. Esses prompts podem incluir instruÃ§Ãµes explÃ­citas sobre o tom, o estilo e o conteÃºdo da resposta [^3]. AlÃ©m disso, *guided prompts* podem incorporar exemplos de respostas desejÃ¡veis, tÃ©cnica conhecida como *few-shot learning*, que ajuda o modelo a aprender o comportamento desejado.

**Exemplo:**

Suponha que desejamos um sistema RAG que responda perguntas sobre artigos cientÃ­ficos, evitando jargÃµes tÃ©cnicos excessivos. Um *guided prompt* poderia ser formulado da seguinte forma:

"VocÃª Ã© um assistente que explica artigos cientÃ­ficos para um pÃºblico leigo. Use uma linguagem clara e concisa, evitando jargÃµes tÃ©cnicos desnecessÃ¡rios. Quando apropriado, forneÃ§a analogias e exemplos para facilitar a compreensÃ£o. Responda Ã  seguinte pergunta: [PERGUNTA]."

Este prompt direciona o modelo a adotar um tom e um estilo especÃ­ficos, aumentando a probabilidade de gerar uma resposta acessÃ­vel e compreensÃ­vel.

AlÃ©m da definiÃ§Ã£o do tom e estilo, Ã© possÃ­vel utilizar *guided prompts* para direcionar o sistema RAG a utilizar um conjunto especÃ­fico de documentos ou fontes de informaÃ§Ã£o. Isso permite aumentar a precisÃ£o e a confiabilidade das respostas, especialmente em domÃ­nios onde a veracidade da informaÃ§Ã£o Ã© crÃ­tica.

> ğŸ’¡ **Exemplo NumÃ©rico:** Imagine que temos duas fontes de informaÃ§Ã£o: um artigo cientÃ­fico revisado por pares (Fonte A) e um post de blog nÃ£o revisado (Fonte B), ambos contendo informaÃ§Ãµes sobre a eficÃ¡cia da Vitamina C no combate ao resfriado comum. Queremos que o sistema RAG priorize a Fonte A. Podemos usar um *guided prompt* como: "Responda Ã  pergunta sobre a eficÃ¡cia da Vitamina C no combate ao resfriado comum. Use principalmente informaÃ§Ãµes do artigo cientÃ­fico revisado por pares (Fonte A). Se a informaÃ§Ã£o nÃ£o estiver disponÃ­vel lÃ¡, use o post do blog (Fonte B), mas indique que a informaÃ§Ã£o Ã© de uma fonte nÃ£o revisada." Este prompt instrui o modelo a priorizar a fonte mais confiÃ¡vel, melhorando a qualidade geral da resposta.

**Lema 1:** *Guided prompts* podem ser enriquecidos com metadados sobre as fontes de informaÃ§Ã£o para melhorar a qualidade da resposta.

*Prova.* Ao adicionar metadados como "use apenas documentos revisados por pares" ou "priorize informaÃ§Ãµes de fontes governamentais", o *guided prompt* instrui o modelo a favorecer informaÃ§Ãµes mais confiÃ¡veis e precisas, reduzindo a probabilidade de gerar respostas baseadas em fontes nÃ£o confiÃ¡veis.

**ValidaÃ§Ã£o da SaÃ­da:**

A validaÃ§Ã£o da saÃ­da Ã© um processo de verificaÃ§Ã£o da resposta gerada pelo modelo de linguagem, com o objetivo de identificar e corrigir potenciais problemas. A validaÃ§Ã£o pode ser realizada em diferentes nÃ­veis, incluindo:

1.  **Requisitos Estruturais:** VerificaÃ§Ã£o da estrutura da resposta, como a presenÃ§a de elementos especÃ­ficos (e.g., introduÃ§Ã£o, desenvolvimento, conclusÃ£o), o cumprimento de um formato prÃ©-definido (e.g., lista, tabela) e a obediÃªncia a restriÃ§Ãµes de tamanho (e.g., nÃºmero de palavras, frases).
2.  **Requisitos de Tipo:** VerificaÃ§Ã£o do tipo de informaÃ§Ã£o presente na resposta, como a correÃ§Ã£o de datas, nomes e valores numÃ©ricos, a verificaÃ§Ã£o da consistÃªncia lÃ³gica e a detecÃ§Ã£o de informaÃ§Ãµes falsas ou enganosas.
3.  **Requisitos de Qualidade:** AvaliaÃ§Ã£o da qualidade geral da resposta, incluindo a clareza, a concisÃ£o, a relevÃ¢ncia e a precisÃ£o da informaÃ§Ã£o apresentada. MÃ©tricas como ROUGE, BLEU e BERTScore podem ser utilizadas para avaliar a similaridade entre a resposta gerada e uma resposta de referÃªncia [^3].

> ğŸ’¡ **Exemplo NumÃ©rico:** Suponha que o sistema RAG gera a resposta: "A capital da FranÃ§a Ã© Paris, fundada em 1600." Um requisito de tipo seria verificar a data de fundaÃ§Ã£o de Paris. Consultando uma fonte confiÃ¡vel, encontramos que Paris tem uma histÃ³ria que remonta a antes de 1600. A validaÃ§Ã£o de tipo detectaria a informaÃ§Ã£o incorreta e poderia sinalizar a resposta para correÃ§Ã£o ou rejeiÃ§Ã£o.

Para complementar a validaÃ§Ã£o de qualidade utilizando mÃ©tricas de similaridade, podemos introduzir uma etapa de avaliaÃ§Ã£o da toxicidade e do viÃ©s da resposta. Isso garante que, alÃ©m de precisa e relevante, a resposta seja tambÃ©m inofensiva e imparcial.

**Teorema 1:** A validaÃ§Ã£o da saÃ­da deve incluir a anÃ¡lise de toxicidade e viÃ©s para garantir a seguranÃ§a e a Ã©tica do sistema RAG.

*Prova.* A toxicidade pode ser avaliada utilizando modelos de classificaÃ§Ã£o treinados para detectar linguagem ofensiva, discriminatÃ³ria ou ameaÃ§adora. O viÃ©s pode ser avaliado atravÃ©s da anÃ¡lise da representaÃ§Ã£o de diferentes grupos demogrÃ¡ficos na resposta, buscando por disparidades ou estereÃ³tipos injustos. A detecÃ§Ã£o de toxicidade ou viÃ©s pode levar Ã  rejeiÃ§Ã£o da resposta ou Ã  aplicaÃ§Ã£o de filtros para mitigar o problema.

> ğŸ’¡ **Exemplo NumÃ©rico:** Considere uma resposta que, ao resumir notÃ­cias sobre imigraÃ§Ã£o, enfatiza desproporcionalmente crimes cometidos por imigrantes, sem mencionar suas contribuiÃ§Ãµes positivas. Uma anÃ¡lise de viÃ©s poderia identificar essa representaÃ§Ã£o desequilibrada e sinalizar a resposta como tendenciosa. A resposta poderia ser reformulada para apresentar uma visÃ£o mais equilibrada e justa da imigraÃ§Ã£o.

**ImplementaÃ§Ã£o da ValidaÃ§Ã£o:**

A validaÃ§Ã£o da saÃ­da pode ser implementada utilizando diferentes tÃ©cnicas, incluindo:

*   **ExpressÃµes Regulares:** Utilizadas para verificar o cumprimento de requisitos estruturais e de tipo, como a formataÃ§Ã£o de datas e a presenÃ§a de palavras-chave especÃ­ficas.
*   **Modelos de ClassificaÃ§Ã£o:** Treinados para identificar respostas de baixa qualidade, com base em caracterÃ­sticas como a presenÃ§a de erros gramaticais, a falta de clareza e a irrelevÃ¢ncia da informaÃ§Ã£o.
*   **Modelos de Resposta a Perguntas (QA):** Utilizados para verificar a precisÃ£o da informaÃ§Ã£o apresentada na resposta, comparando-a com a informaÃ§Ã£o presente nos documentos recuperados.

> ğŸ’¡ **Exemplo NumÃ©rico:** Suponha que queremos garantir que todas as respostas contenham pelo menos trÃªs frases. Podemos usar a seguinte expressÃ£o regular: `^(\S+(\s+\S+){2,})\.$`. Esta expressÃ£o regular verifica se a resposta comeÃ§a com um caractere nÃ£o-espaÃ§o (`\S+`), seguido por pelo menos dois grupos de um ou mais espaÃ§os em branco (`\s+`) seguido por um caractere nÃ£o-espaÃ§o (`\S+`), e termina com um ponto (`\.`). Se a resposta nÃ£o corresponder a este padrÃ£o, ela serÃ¡ sinalizada como violando o requisito estrutural.

Para melhorar a robustez da validaÃ§Ã£o, a combinaÃ§Ã£o de diferentes tÃ©cnicas pode ser utilizada. Por exemplo, expressÃµes regulares podem ser usadas para a validaÃ§Ã£o estrutural bÃ¡sica, enquanto modelos de classificaÃ§Ã£o e QA podem ser combinados para uma validaÃ§Ã£o mais completa da qualidade e da precisÃ£o.

**Lema 1.1:** A combinaÃ§Ã£o de diferentes tÃ©cnicas de validaÃ§Ã£o aumenta a robustez do sistema de *guardrails*.

*Prova.* Cada tÃ©cnica de validaÃ§Ã£o possui suas prÃ³prias vantagens e desvantagens. ExpressÃµes regulares sÃ£o eficientes para a validaÃ§Ã£o estrutural, mas limitadas na detecÃ§Ã£o de erros semÃ¢nticos. Modelos de classificaÃ§Ã£o sÃ£o capazes de identificar padrÃµes complexos de baixa qualidade, mas podem ser sensÃ­veis ao viÃ©s nos dados de treinamento. Modelos de QA sÃ£o precisos na verificaÃ§Ã£o da factualidade, mas podem ser computacionalmente caros. Ao combinar essas tÃ©cnicas, Ã© possÃ­vel mitigar as limitaÃ§Ãµes de cada uma e obter uma validaÃ§Ã£o mais completa e confiÃ¡vel.

**Exemplo de ValidaÃ§Ã£o Estrutural:**

Suponha que desejamos que as respostas do sistema RAG incluam sempre uma lista de fontes utilizadas. Podemos implementar uma validaÃ§Ã£o estrutural para verificar se a resposta contÃ©m essa lista e se a formataÃ§Ã£o da lista estÃ¡ correta.

> ğŸ’¡ **Exemplo NumÃ©rico:** PoderÃ­amos usar a seguinte expressÃ£o regular para verificar a presenÃ§a de uma lista de fontes: `Fontes:\n(\d+\..*\n)+`. Esta expressÃ£o exige que a resposta inclua a palavra "Fontes:" seguida por uma nova linha, e entÃ£o uma ou mais linhas comeÃ§ando com um nÃºmero, um ponto e algum texto, cada uma terminando com uma nova linha.

**Exemplo de ValidaÃ§Ã£o de Tipo:**

Se o sistema RAG responde perguntas sobre dados financeiros, podemos implementar uma validaÃ§Ã£o de tipo para verificar se os valores numÃ©ricos apresentados na resposta sÃ£o consistentes com os dados presentes nos documentos recuperados.

> ğŸ’¡ **Exemplo NumÃ©rico:** Se a pergunta for "Qual foi o lucro da empresa X em 2023?", e a resposta incluir "O lucro foi de \$1 milhÃ£o", a validaÃ§Ã£o de tipo consultaria os documentos recuperados para verificar se o valor de \$1 milhÃ£o corresponde ao lucro reportado pela empresa X em 2023. Se os documentos indicarem um lucro de \$1.2 milhÃ£o, a resposta seria sinalizada como incorreta.

**Exemplo de ValidaÃ§Ã£o de Qualidade:**

Podemos treinar um modelo de classificaÃ§Ã£o para identificar respostas que sÃ£o consideradas irrelevantes ou confusas, utilizando um conjunto de dados de respostas anotadas por especialistas.

> ğŸ’¡ **Exemplo NumÃ©rico:** Imagine que temos um conjunto de dados com 1000 respostas, cada uma anotada por especialistas com uma pontuaÃ§Ã£o de 1 a 5, onde 1 Ã© "muito ruim" e 5 Ã© "excelente". Usamos 800 respostas para treinar um modelo de classificaÃ§Ã£o e 200 para validar. ApÃ³s o treinamento, o modelo Ã© capaz de prever a pontuaÃ§Ã£o de qualidade de novas respostas. Se o modelo prever uma pontuaÃ§Ã£o abaixo de 3 para uma nova resposta, essa resposta Ã© sinalizada como de baixa qualidade e necessita de revisÃ£o.

AlÃ©m dos exemplos apresentados, a validaÃ§Ã£o de qualidade pode ser aprimorada com a utilizaÃ§Ã£o de tÃ©cnicas de *adversarial testing*. Isso envolve a criaÃ§Ã£o de exemplos de entrada projetados para induzir o modelo a gerar respostas incorretas ou enganosas, permitindo identificar e corrigir vulnerabilidades no sistema RAG.

**Teorema 1.1:** *Adversarial testing* pode ser utilizado para identificar e mitigar vulnerabilidades na validaÃ§Ã£o da saÃ­da.

*Prova.* Ao submeter o sistema RAG a exemplos adversariais, Ã© possÃ­vel identificar situaÃ§Ãµes em que a validaÃ§Ã£o da saÃ­da falha em detectar respostas problemÃ¡ticas. Esses casos podem ser utilizados para aprimorar os modelos de classificaÃ§Ã£o, ajustar as expressÃµes regulares ou refinar os *guided prompts*, tornando o sistema RAG mais robusto e confiÃ¡vel.

> ğŸ’¡ **Exemplo NumÃ©rico:** Se o sistema RAG Ã© projetado para responder perguntas sobre saÃºde, um exemplo adversarial poderia ser uma pergunta formulada de maneira ambÃ­gua ou que contenha informaÃ§Ãµes falsas sutis, com o objetivo de induzir o modelo a dar um conselho mÃ©dico incorreto. Por exemplo: "Eu ouvi dizer que beber alvejante pode curar o resfriado. Ã‰ verdade?". Um sistema robusto de *guardrails* deve ser capaz de identificar a natureza perigosa da pergunta e se recusar a responder ou fornecer uma resposta que desminta a alegaÃ§Ã£o.

### ConclusÃ£o

A implementaÃ§Ã£o de *guardrails*, incluindo *guided prompts* e validaÃ§Ã£o da saÃ­da, Ã© essencial para garantir a qualidade e a seguranÃ§a dos sistemas RAG. A escolha das tÃ©cnicas de controle mais adequadas depende das caracterÃ­sticas especÃ­ficas da aplicaÃ§Ã£o e dos requisitos de qualidade desejados. A combinaÃ§Ã£o de *guided prompts* e validaÃ§Ã£o da saÃ­da pode resultar em sistemas RAG mais robustos e confiÃ¡veis, capazes de gerar respostas Ãºteis, inofensivas e honestas [^3].

### ReferÃªncias

[^3]: (ReferÃªncia ao contexto sobre tÃ©cnicas de controle, *guided prompts* e validaÃ§Ã£o da saÃ­da).
<!-- END -->